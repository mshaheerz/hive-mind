<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DevEnv Setup Wizard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Simple spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            border-left-color: #4F46E5;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
<div class="bg-white p-8 rounded shadow-md w-96">
    <h1 class="text-2xl font-bold mb-4 text-center">DevEnv Setup Wizard</h1>

    <form id="setupForm" class="space-y-4">
        <label class="block">
            <span class="text-gray-700">Project Type</span>
            <select name="project_type" id="projectType" class="mt-1 block w-full rounded border-gray-300">
                <option value="python">Python</option>
                <option value="nodejs">Node.js</option>
            </select>
        </label>

        <button type="submit"
                class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">
            Start Setup
        </button>
    </form>

    <!-- Spinner (hidden by default) -->
    <div id="spinner" class="flex justify-center mt-4 hidden">
        <div class="spinner"></div>
    </div>

    <!-- Result area -->
    <pre id="result" class="mt-4 p-2 bg-gray-100 rounded overflow-auto hidden"></pre>
</div>

<script>
    const form = document.getElementById('setupForm');
    const spinner = document.getElementById('spinner');
    const resultBox = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        spinner.classList.remove('hidden');
        resultBox.classList.add('hidden');
        resultBox.textContent = '';

        const projectType = document.getElementById('projectType').value;

        try {
            const response = await fetch('/setup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ project_type: projectType })
            });

            const data = await response.json();

            if (response.ok) {
                resultBox.textContent = data.output || 'Setup completed successfully.';
                resultBox.classList.remove('hidden');
            } else {
                resultBox.textContent = `Error: ${data.message || 'Unknown error.'}`;
                resultBox.classList.remove('hidden');
            }
        } catch (err) {
            resultBox.textContent = `Network error: ${err}`;
            resultBox.classList.remove('hidden');
        } finally {
            spinner.classList.add('hidden');
        }
    });
</script>
</body>
</html>
